<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Small Plans</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
    </style>
    <script>
        // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API
        function storageAvailable(type) {
            let storage;
            try {
                storage = window[type];
                let x = '__storage_test__';
                storage.setItem(x, x);
                storage.removeItem(x);
                return true;
            }
            catch(e) {
                return e instanceof DOMException && (
                        // everything except Firefox
                    e.code === 22 ||
                    // Firefox
                    e.code === 1014 ||
                    // test name field too, because code might not be present
                    // everything except Firefox
                    e.name === 'QuotaExceededError' ||
                    // Firefox
                    e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&
                    // acknowledge QuotaExceededError only if there's something already stored
                    (storage && storage.length !== 0);
            }
        }
        function newItemSummary(summary) {
            let now = new Date();
            return {
                id: now.getTime().toString(36),
                summary: summary,
                details: '',
                createAt: now,
                updateAt: now,
                doneAt: null,
                deletedAt: null,
            }
        }
        function summaryKey(id) {
            return `summary-${id}`;
        }
    </script>
</head>
<body>

<h1><span id="project-title">Small Plans</span><button id="proj-title-btn">edit</button></h1>
<h2 id="project-description"></h2>

<dialog id="proj-title-dialog"
        style="width: 80%; height: 300px; position: absolute; top: 30px;">
    <form autocomplete="off">
        <p>
            <label class="projectLabel" for="project-title-input">Project Title:</label>
            <input type="text" id="project-title-input" class="field" />
        </p>
        <p>
            <label class="projectLabel" for="description-input">Description:</label>
            <textarea id="description-input" class="field"></textarea>
        </p>
        <p>
            <input id="proj-title-ok" type="button" value="ok">
            <button id="proj-title-cancel">cancel</button>
        </p>
    </form>
</dialog>

<form autocomplete="off">
    <label for="todo-input"></label>
    <textarea id="todo-input" rows="3"></textarea>
    <input type="button" value="ok" id="add-todo-btn" />
</form>

<template id="todo-details-template">
    <details class="undone">
        <summary>
            Beauxbatons Academy of Magic Academy of Magic Academy of Magic Academy of Magic Beauxbatons Academy of Magic
            <a href="#">edit</a>
        </summary>
        <div class="DateAndButtons">
            <div class="cell date"><a href="#">(done)</a></div>
            <div class="cell buttons"><a href="#">edit</a> . <a href="#">delete</a> . <a href="#">more</a></div>
        </div>
        <pre>If you like your magic served with a dash of savoir faire, this school is for you. Beauxbatons welcomes a multitude of students of different nationalities, mainly French, but also Spanish, Portuguese, Dutch, Luxembourgian and Belgian.
        </pre>
    </details>
</template>

<script>
    if (!storageAvailable('localStorage')) {
        window.alert("当前浏览器不支持 localStorage, 因此, 关闭浏览器前请先保存数据.")
    }
    const projTitle = document.getElementById('project-title');
    const projTitleInput =  document.getElementById('project-title-input');
    const projDescription = document.getElementById('project-description');
    const projDescriptionInput = document.getElementById('description-input');
    if (localStorage.getItem('projectTitle')) {
        projTitle.innerText = localStorage.getItem('projectTitle');
        projDescription.innerText = localStorage.getItem('projectDescription');
    }
    const projTitleDialog = document.getElementById('proj-title-dialog');
    const projTitleBtn = document.getElementById('proj-title-btn');
    const projTitleOk = document.getElementById('proj-title-ok');
    const projTitleCancel = document.getElementById('proj-title-cancel');
    projTitleBtn.addEventListener('click', function() {
        projTitleInput.value = projTitle.innerText;
        projDescriptionInput.value = projDescription.innerText;
        projTitleDialog.setAttribute('open', '');
    });
    projTitleCancel.addEventListener('click', function(event) {
        event.preventDefault();
        projTitleDialog.removeAttribute('open');
    });
    projTitleOk.addEventListener('click', function() {
        projTitle.innerText = projTitleInput.value;
        localStorage.setItem('projectTitle', projTitle.innerText);
        projDescription.innerText = projDescriptionInput.value;
        localStorage.setItem('projectDescription', projDescription.innerText);
        projTitleDialog.removeAttribute('open');
    });
    const todoInput = document.getElementById('todo-input');
    const addTodoBtn = document.getElementById('add-todo-btn');
    addTodoBtn.addEventListener('click', function(event) {
        event.preventDefault();
        let todo = todoInput.value.trim();
        if (todo) {
            let item = newItemSummary(todo);
            localStorage.setItem(summaryKey(item.id), todoInput.value);
        }
    });
</script>
</body>
</html>
